---
title: "College Analysis"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 4
---

```{r setup, include=FALSE}
library(flexdashboard)
```

<style type="text/css">

.text { 
   font-size: 18px;
   font-family: Helvetica;}

</style>



About {data-icon="fas fa-search"}
===================================== 


### About this flexdashboard

<div class="text"> 
This dashboard allows you to explore 1500+ colleges in the United States. The dashboard will cover:

1. The quick overview of William Jessup University tuition (the school which the author currently attends)

2. The analysis for the tuition price for colleges around the US

3. College recommendation based on some specific criterias.
</div>

Getting Our Data Ready {data-icon="fas fa-wrench"}
==============================================


Column 1 {data-width=400}
---------------------------------

### Getting Data

```{r, echo=TRUE, eval=FALSE}
library(rscorecard)
library(rstudioapi)
library(knitr)
library(dplyr)

# Key registration https://collegescorecard.ed.gov/data/documentation/
my_key <- askForPassword()
sc_key(my_key)


# Population predominantly bachelor's-degree granting colleges (preddeg==3)
df <- sc_init() %>% 
  sc_filter(preddeg==3) %>%
  sc_select(unitid, instnm, stabbr, city, actcm25, actcm75, ugds, control, distanceonly,
            md_earn_wne_p6, md_earn_wne_p8, md_earn_wne_p10,
            npt4_pub,npt4_priv, 
            omawdp8_ftft, 
            latitude,longitude) %>%
  sc_year('latest') %>% 
  sc_get()

# Exclusions 
# (1) Not online only (DISTANCEONLY == 0)
# (2) College in US state (exclude DC and US territories)

excluded_strabbr <- unique(df$stabbr[!df$stabbr %in% state.abb])
df <- df[df$stabbr %in% state.abb,]
df <- df[df$distanceonly == 0,]
save(df,"your file path")

```



## Column 2

### Our Data Sample

```{r, echo=TRUE}
load('college.Rda')
knitr::kable(head(df, n=8))
dim(df)
``` 

William Jessup University {data-icon="fas fa-school" .storyboard} 
=================================================

### Setup 



<div class="text"> 

* Load college scorecard data, college_scorecard.Rda for data frame, df

* Clean up college scorecard data

  - Create a new variable, npt, that combines npt4_priv and npt4_pub.
  
  - Filter df where npt is not null, !is.na()
  
* Add a factor variable for control with labels 1=public, 2=private, 3=for profit
 </div>

### Our Cleaned Data After The Setup 

```{r}
library(rscorecard)
library(rstudioapi)
library(knitr)
library(dplyr)
library(ggplot2)
library(scales)
library(gridExtra)
df$control <- factor(df$control, labels = c('public','private','for profit'))
df$npt <- df$npt4_priv
df$npt[is.na(df$npt)] <- df$npt4_pub[is.na(df$npt)]
df <- df %>% select(-c(npt4_priv,-npt4_pub))
df <- df[!is.na(df$npt),]
kable(df)
```





### William Jessup Net Price Tuition
<div class="text"> 
* What is William Jessup’s net price to tuition, npt, and how does it compare to the general US tuition?

```{r, echo=FALSE}

# Calculate William Jessup’s percent rank. Use calculation in a sentence to support answer.

df <- df %>% mutate(rank_all = percent_rank(npt))
college <- 'William Jessup University'
jessup_percent_rank <- df %>% filter(instnm==college) %>% select(rank_all)
jessup_percent_rank <- percent(jessup_percent_rank$rank_all)

# Calculate William Jessup’s percent rank for private colleges. Use calculation in a sentence to support answer
df <- df %>% group_by(control) %>% mutate(rank_control = percent_rank(npt))
jessup_percent_rank_private <- df %>% filter(instnm==college) %>% select(rank_control)
jessup_percent_rank_private <- percent(jessup_percent_rank_private$rank_control)
  
# Create a histogram of net price tuition, npt, with a reference line for William Jessup
jessup_ref <- df$npt[df$instnm==college]
plot1 <- ggplot(df, aes(x=npt)) + geom_histogram() + geom_vline(xintercept=jessup_ref, color='green')
# Create a histogram of net price tuition, npt, with a reference line for William Jessup and facet_wrap by control variable
plot2 <- ggplot(df, aes(x=npt)) + geom_histogram() + geom_vline(xintercept=jessup_ref, color='green') + facet_wrap(~control)
# Calculate the correlation, cor, between npt and longitude and npt and latitude
cor1 <- cor(df$npt,df$longitude)
cor2 <- cor(df$npt,df$latitude)

#Combine two scatter plots where of x=longitude,y = npt and where x=latitude,y = npt side by side.
plot3 <- ggplot(df, aes(x=longitude, y=npt)) + geom_point()
plot4 <- ggplot(df, aes(x=latitude, y=npt)) + geom_point()


#Create another scatter plot of your choice starting with x=longitude, y=latitude.


df_q4 <- df
stats <- summary(df_q4$npt)
df_q4$npt_q3 <-df_q4$npt >= stats[5]
p4 <- ggplot(df_q4, aes(longitude, latitude, color = npt_q3 ,alpha = .2)) +  geom_point() + borders("state") + scale_color_manual(values=c("gray", "red")) + labs(title = 'NPT in top quartile')

```

**William Jessup University is `r jessup_percent_rank` for all US colleges and `r jessup_percent_rank_private` for private for percent rank on net price of tuition, npt.**

```{r, echo=FALSE}
plot1
```


* How does it compare to the private college tuition?


```{r, fig.width=12, echo=FALSE}
plot2
```
</div> 

College Tuition {data-icon="fas fa-university" .storyboard}
=======================================================
<div class="text"> 
* Based on npt, what areas of the country is tuition more expensive? Any theories why?

**The latitude correlation, `r cor2`, is higher compared to longitude correlation, `r cor1` but still both have weak linear correlation. Based on the scatter plots below there is a noticeable pattern especially the variance along the coast. The next question to investigate is if the higher tuition colleges (top quartile) are located by major cities. **

```{r, fig.width=12, echo=FALSE}
grid.arrange(plot4,plot3,ncol=2)
```

```{r, fig.width=12, fig.height=8, echo=FALSE}
p4
```
</div> 



